<!-- this is an example for an AsTeRICS demo solution startpage. Please edit it for your needs. -->
<!DOCTYPE html>
<html>
  	<head>
		<!-- Initial setup
		================================================== -->
		<!-- Browser compatiblity, sf. https://stackoverflow.com/questions/6771258/what-does-meta-http-equiv-x-ua-compatible-content-ie-edge-do -->
		<meta http-equiv="X-UA-Compatible" content="chrome=1">

		<!-- Character set encoding -->
		<meta charset='utf-8'>

		<!-- Ensure proper rendering (#responsive) -->
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

		<!-- Stylesheets
		================================================== -->
		<!-- Adapt/add styles if necessary -->
		<link rel="stylesheet" type="text/css" href="../startpage/style/main.css">

		<!-- bootstrap 3 (#responsive) supports also IE8-9 -->
		<!-- bootstrap 4 (#responsive) from http://getbootstrap.com -->
		<!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous"> -->
		<link rel="stylesheet" href="../startpage/style/bootstrap.min.css">

		<!-- Modal styleheet -->
		<link rel="stylesheet" href="../startpage/style/modal.css">

	    <!-- provided from AsTeRICS 3.0 -->
	  	<script type="text/javascript" src="../startpage/lib/jquery-3.2.1.min.js"></script>
	    <script src="../startpage/clientExample/javascript/JSmap.js"></script>
	    <script src="../startpage/clientExample/javascript/areCommunicator.js"></script>
		<!-- provided by this repository, should be part of the framework later -->
		<script src="../startpage/lib/webAppUtils.js"></script>
		<script src="../startpage/lib/modelManipulation.js"></script>
	
	    <!--[if lt IE 9]>
	    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	    <![endif]-->
	
		<script type="text/javascript">
			//Set the base URI of the running ARE instance.     
			//You could also make this configurable by the user.
			setBaseURI("http://localhost:8081/rest/");
	
			var modelFilePathOnWebserver='webapps/asterics-smarthome-knx/models/KNX.acs';
	
			function applyAndStart() {
				/* 
				Normally you can just call applySettingsInXMLModelAndStart(modelFilePathOnWebserver);
				But to assign the switches to certain events we have to trigger the respective routing event (select1-select7) of
				the EventRouter plugin.
				*/
				applySettingsInXMLModelAndStart(modelFilePathOnWebserver, function(data,HTTPStatus){
					//We now have to manually change the event routes from the swith inputs to the assigned mouse events.			
					triggerEvent(function(data,HTTPStatus){
						triggerEvent(defaultSuccessCallback,defaultErrorCallback,"KeySwitch2EventRouter",$("#switch2Action").val());
					},defaultErrorCallback,"KeySwitch1EventRouter",$("#switch1Action").val());
				});
			}
			
			window.onload=updateWidgetsFromDeployedModel;		
		</script>
	
	

		<title>AsTeRICS KNX Demo</title>
	</head>

	<body>

		<h1>AsTeRICS KNX Demo</h1>


		<!-- Navigation Bar
		================================================== -->
		<nav id="navigation-bar-wrapper" class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
			<a class="navbar-brand" href="#">AsTeRICS KNX Demo</a>
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation-bar-content" aria-controls="navigation-bar-content" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>

			<!-- FIXME: Navigation bar covers headings of page references -->
			<div id="navigation-bar-content" class="collapse navbar-collapse">
				<ul class="navbar-nav mr-auto">
					<li class="nav-item active">
						<!-- sr-only class is visible to screen reader only (#accessibility) -->
						<a class="nav-link" href="#objective">Objective<span class="sr-only">(current)</span></a>
					</li>
					<li class="nav-item active">
						<a class="nav-link" href="#description">Description</a>
					</li>
					<li class="nav-item active">
						<a class="nav-link" href="#requirements">Requirements</a>
					</li>
					<li class="nav-item active">
						<a class="nav-link" href="#demos">Demo</a>
					</li>
					<li class="nav-item active">
						<a class="nav-link" href="#additional_material">Additional Material</a>
					</li>
				</ul>
				<form class="form-inline my-2 my-lg-0">
					<input class="form-control mr-sm-2" placeholder="Search" aria-label="Search" type="text">
					<button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
				</form>
			</div>
		</nav>

		<!-- Main Content
		================================================== -->
		<main role="main">

			<!-- Main jumbotron for a primary marketing message or call to action -->
			<div class="jumbotron">
				<div class="container">
					<h1 class="display-3">AsTeRICS KNX Demo</h1>
					<p>This demo shows how a KNX system can be integrated into AsTeRICS.
					</p><a class="btn btn-primary btn-lg" href="https://github.com/asterics/AsTeRICS" role="button">Learn more Â»</a>
				</div>
			</div>


			<!-- Sections -->
			<!-- TODO: Adapt as needed -->
			<div class="container">

				<!-- Section 1 -->
				<div class="col" id="objective">
					<h2>Objective</h2>
					<p>This example contains the most important functions, like
					<ul>
						<li>Switching (On/Off)</li>
						<li>Blinds (Up/Down)</li>
						<li>Dimming (relative)</li>
						<!--<li>Dimming absolute</li> -->
					</ul>
					<span class="sr-only">(current)</span></p>
				</div><hr>

				<!-- Section 2 -->
				<div class="col" id="description">
					<h2>Description</h2>
					<p>This demo is based on the smart home kit hardware. The purpose of this Smart Home Kit is to simulate a Smart Home with different devices and technologies.
						There are two rooms in the demo case. Heating, cooling, lighting and
						shading are controlled by KNX components. The air ventilation system on the top is controlled by a
						Wago PLC. On the right upper side a Raspberry Pi 3 is mounted.</p>
					<img class="svgmodal" src="img/shk_front.jpg" width="50%" alt="Smart Home Kit - Demo Case"/>

				</div><hr>

				<!-- Section 3 -->
				<div class="col" id="requirements">
					<h2>Requirements</h2>
					<p>For this demo you need
						<ul>
							<li><a href="https://github.com/asterics/AsTeRICS/releases/tag/v3.0" target="_blank">AsTeRICS 3.0</a> installed and ARE running</li>
							<li>OS: Windows, Linux (incl. RPi), Mac OSX</li>
							<li>A little knowledge on KNX</li>
							<li>A KNX system and a list of the group addresses </li>
						</ul>
						<hr>
					</p>
				</div>

				<!-- Section 4 -->
				<div class="col" id="demos">
					<h2>KNX Demo</h2>

					To run this demonstration, the IP address of the KNX/IP Router and the group addresses have to be adapted.

					<h3>Configure IP settings</h3>

					<p>The following IP addresses have to be adapted in the properties of the KNX plugin:
					<ul>
						<li>localIP: The IP address of the machine AsTeRICS is running </li>
						<li>KNXNetIP: The IP address of the KNX IP gateway </li>
					</ul>

						<img class="svgmodal" src="img/knx_ip.png" width="90%" alt="IP settings"/>
						</p>
					</div>

					<div class="col" id="demo2">
						<h3>Adapt group addresses</h3>
						As next step, the group addresses have to be adapted. In this demo, four different commands are implemented:

				    <ol>
		   			  <li>Switching a light:</li>
					  A light can by switched on and off with two buttons. In this demo case the group address is 1/0/0.

					  <li>Move blinds:</li>
					  The blinds are controlled with two buttons. The group address is 2/0/0.

					  <li>Dimming a light with buttons:</li>
					  The light is controlled with two buttons. The group address is 1/0/6.

					 <!--  <li>Dimming a light with a slider:</li>
					  The brightness of the light is controlled with the light. The group address is 1/0/8.
					</ol> -->
						<img class="svgmodal" src="img/knx_groupaddresses.png" width="80%" alt="edit group addresses"/>
					</div><hr>

<div class="col" id="configuration">
    <h2>Configure for your system</h2>
          <h3>IP settings:</h3>
          <p><label for="localIP" title="Enter your local IP">local IP address of your Computer: </label>
    	  <input id="localIP" type="text" placeholder="192.168.1.17" value="" data-asterics-model-binding-1='{"componentKey": "Knx.1","propertyKey": "localIP"}'></p>
          <p><label for="knxIP" title="Enter your local IP"> IP address of the KNX/IP Router: </label>
          <input id="knxIP" type="text" placeholder="192.168.1.2" value="" data-asterics-model-binding-1='{"componentKey": "Knx.1","propertyKey": "KNXNetIP"}'></p>
          <h3>Group addresses:</h3>
          <p><label for="Switch_GroupAddress" title="Group address for Switching: "> Group address for Switching: </label>
          <input id="Switch_GroupAddress" type="text" placeholder="1/0/0" value="" data-asterics-model-binding-1='{"componentKey": "Knx.1","propertyKey": "groupAddress1"}' data-asterics-model-binding-2='{"componentKey": "Knx.1","propertyKey": "groupAddress2"}'></p>
          <p><label for="Blind_GroupAddress" title="Group address for Shutters:"> Group address for Shutters: </label>
          <input id="Blind_GroupAddress" type="text" placeholder="1/0/0" value="" data-asterics-model-binding-1='{"componentKey": "Knx.1","propertyKey": "groupAddress3"}' data-asterics-model-binding-2='{"componentKey": "Knx.1","propertyKey": "groupAddress4"}'></p>
		  <p><label for="DimmRel_GroupAddres" title="Group address for Dimming (relative)"> Group address for Dimming (relative):</label>
         <input id="DimmRela_GroupAddres" type="text" placeholder="1/0/0" data-asterics-model-binding-1='{"componentKey": "Knx.1","propertyKey": "groupAddress5"}' data-asterics-model-binding-2='{"componentKey": "Knx.1","propertyKey": "groupAddress6"}'></p>

		  
		  <p>
		  <button onclick="applyAndStart()" title="Description: Applies all settings and starts the model" class="button"> Start Model </button>
	 	  <button onclick="saveSettingsAsAutostartModel()" title="Description: Applies all settings and sets the model as autostart model" class="button"> Save Settings as Autostart </button>	
		  <p>  
		  
		  
     	<!-- Section 4 -->
		<div class="col" id="moreinfo">
		<h2>More information</h2>
		<h3>Input Port Description</h3>

<ul>
<li><strong>actionString [string]:</strong> This port receives string commands for the KNX component. The commands have to be in the format "@KNX: group_address,datapoint_type,value". The delimiters ',', '#' and ' ' are allowed. An example for a valid command is"@KNX:1/1/1,1.001,on". As a valid command is received by the input port, the value is sent to the KNX group address. The group addresses comply to the setup of the KNX network which can be configured with the ETS software. </li>
<li><strong>slider[1-6] [double]:</strong> Input port for a double value which is converted to a given datapoint (Property: DPTSlider[1-6]) and sent to the given KNX group address (Property: groupAddressSlider[1-6]
</ul>
<h3>Output Port Description</h3>
<ul>
<li><strong>data [1-6] [string]:</strong> These output ports are sending received data from the group addresses (Property: groupAddressOutput[1-6]). The data interpretation is controlled by the DPT (datapoint type, property: DPTOutput[1-6])
</ul>
<h3>Properties</h3>
<ul>
<li><strong>localIP [string]:</strong> The local IP address of the interface which can reach the KNXnetIP.</li>
<li><strong>KNXNetIP [string]:</strong> The destination IP address of the KNX gateway.</li>
<li><strong>NAT [boolean]:</strong> Enable NAT</li>

<li><strong>groupAddress[1-6] [string]:</strong> (Event Listener) Specifies KNX group addresses for the [n] Event Listener e.g. "1/1/1".</li>
<li><strong>dataValue[1-6] [string]:</strong> (Event Listener) Date value, which should be sent (triggered by the input event). The possible values are determined by the used DPT property (see the chapter on datapoint types)</li>
<li><strong>DPTEvent[1-6] [string/dropdown]:</strong> (Event Listener) Specifies the DPT (datapoint type) of the dataValue[1-6] which is sent to the KNX group address, triggered by the input event.</li>

<li><strong>groupAddressSlider[1-6] [string]:</strong> (Input port) Specifies KNX group addresses for the Slider[n].</li>
<li><strong>DPTSlider[1-6] [string/dropdown]:</strong> (Input port) Determines the datapoint type corresponding to the sliders [1-6].</li>

<li><strong>groupAddressTrigger[1-6] [string]:</strong> (Event Trigger) Specifies KNX group addresses for the Event Trigger [n]. The event is triggered if ANY action is happening on the given group address. If you need additional data processing, please use the output ports and process the received data values.</li>

<li><strong>groupAddressOutput[1-6] [string]:</strong> (Output port) Specifies the KNX group addresses, which are sent to the output ports. If there is anything happening on the given group adresses, the corresponding data is sent to the output ports.</li>
<li><strong>DPTOutput[1-6] [string/dropdown]:</strong> (Output port) Determines the datapoint type for the output port. The received data interpretation is defined by the DPTOutput property.</li>
</ul>
<h3>Event Listener</h3>
<ul>
<li><strong>send[1-6]:</strong> Each time an event is triggered, the corresponding KNX command which is specified in the plugin properties (groupAddress[1-6],dataValue[1-6],DPTEvent[1-6]), is issued.</li>
<li><strong>read[1-6]:</strong> Trigger a read command on the output port. The settings for the group address and the DPT are the same as for the output ports (groupAddressOutput[1-6], DPTOutput[1-6]).</li>
</ul>
<h3>Event Trigger</h3>
<ul>
<li><strong>event_out_[1-6]:</strong> When there is any activity on the given KNX group address, set by the properties (groupAddressTrigger[1-6]) an event is raised by this plugin.</li>
</ul>
	</div><hr>

				<!-- Section 5 -->
				<div class="col" id="additional_material">
					<h2>Additional Material</h2>
					<div class="col" id="majorplugins">
						<h3>Major Plugins</h3>
						<ul>
							<li><a target="_blank" href="http://asterics.github.io/AsTeRICS/webapps/WebACS/help/index.html?plugins&actuators/Knx.htm">KNX</a></li>
						</ul>
					</div>

					<div class="col" id="editmodel">
						<h3>Edit Model</h3>
						<a target="_blank" href="http://asterics.github.io/AsTeRICS/webapps/WebACS/?areBaseURI=http://localhost:8081&openFile=http://asterics.github.io/AsTeRICS/webapps/asterics-smarthome-knx/models/KNX.acs">Open in WebACS</a>
					</div>

					<div class="col" id="sourcerepository">
						<h3>Source Repository</h3>
						<p>Fork and modify this <a target="_blank" href="https://github.com/asterics/asterics-smarthome-knx">repository</a>.</p>
					</div>



					<div class="col" id="relatedtutorials">
						<h3>Related Tutorials</h3>
						<ul>
							<li><a target="_blank" href="https://github.com/asterics/AsTeRICS/blob/master/Documentation/AsTeRICS_CameraMouseCreation_StepbyStep_Tutorial.pdf">Camera Mouse Creation StepbyStep Tutorial</a></li>
						</ul>
					</div>
				</ul>


				</div>

			</div>

		</main>

	</body>


	<!-- Placed at the end, so the page loads faster -->
	<!-- Bootstrap core JavaScript
	================================================== -->
	<!-- jQuery first, then Popper.js, then Bootstrap JS -->
		<!-- <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script> -->
	<!-- <script src="../startpage/lib/jquery-3.2.1.slim.min.js"></script> -->
	<script src="../startpage/lib/jquery-3.2.1.js"></script>
		<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script> -->
	<script src="../startpage/lib/popper.min.js"></script>
		<!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script> -->
	<script src="../startpage/lib/bootstrap.min.js"></script>

	<!-- Modal image
	================================================== -->
	<!-- Modal image container -->
	<div id="modalwrapper" class="modal">
			<span class="close" onclick="document.getElementById('modalwrapper').style.display='none'">&times;</span>
			<img class="modal-content" id="modalimage">
			<div id="caption"></div>
	</div>
	<!-- Modal image action script -->
	<script src="../startpage/lib/modal.js"></script>
	<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script> -->


	<!-- AsTeRICS
	================================================== -->
	<!-- provided from AsTeRICS 3.0 -->
	<!-- FIXME: Is jquery file necessary anymore? -->
	<!-- <script type="text/javascript" src="../startpage/lib/jquery-3.2.1.min.js"></script> -->
	<script src="../startpage/clientExample/javascript/JSmap.js"></script>
	<script src="../startpage/clientExample/javascript/areCommunicator.js"></script>

	<!-- provided by this repository, should be part of the framework later -->
	<script src="../startpage/lib/demoLib.js"></script>
</html>
